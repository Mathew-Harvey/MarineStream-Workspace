<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fleet Command Setup | MarineStream</title>
  <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: linear-gradient(135deg, #0a1628, #1a2744);
      min-height: 100vh;
      color: #f1f5f9;
      padding: 40px 20px;
    }
    
    .container {
      max-width: 700px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .logo {
      height: 48px;
      margin-bottom: 16px;
    }
    
    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .subtitle {
      color: #94a3b8;
      font-size: 16px;
    }
    
    .card {
      background: rgba(30, 41, 59, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
    }
    
    .card h2 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .step-number {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
    }
    
    .card p {
      color: #94a3b8;
      line-height: 1.6;
      margin-bottom: 16px;
    }
    
    .bookmarklet-container {
      background: #0f172a;
      border: 2px dashed #334155;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      margin: 20px 0;
    }
    
    .bookmarklet-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 28px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 15px;
      cursor: grab;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }
    
    .bookmarklet-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
    }
    
    .bookmarklet-btn:active {
      cursor: grabbing;
    }
    
    .drag-hint {
      margin-top: 12px;
      font-size: 13px;
      color: #64748b;
    }
    
    .drag-hint strong {
      color: #f59e0b;
    }
    
    .steps-list {
      list-style: none;
      counter-reset: steps;
    }
    
    .steps-list li {
      counter-increment: steps;
      padding: 12px 0;
      padding-left: 36px;
      position: relative;
      color: #cbd5e1;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }
    
    .steps-list li:last-child {
      border-bottom: none;
    }
    
    .steps-list li::before {
      content: counter(steps);
      position: absolute;
      left: 0;
      width: 24px;
      height: 24px;
      background: #334155;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      color: #94a3b8;
    }
    
    .highlight {
      background: rgba(59, 130, 246, 0.2);
      padding: 2px 6px;
      border-radius: 4px;
      color: #60a5fa;
    }
    
    .success-box {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 10px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .success-box svg {
      width: 24px;
      height: 24px;
      color: #22c55e;
      flex-shrink: 0;
    }
    
    .video-placeholder {
      background: #1e293b;
      border-radius: 12px;
      padding: 60px 20px;
      text-align: center;
      color: #64748b;
      margin: 16px 0;
    }
    
    .btn-primary {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-primary:hover {
      filter: brightness(1.1);
    }
    
    .footer {
      text-align: center;
      margin-top: 40px;
      color: #64748b;
      font-size: 13px;
    }
    
    .footer a {
      color: #3b82f6;
      text-decoration: none;
    }
    
    @media (max-width: 600px) {
      .card {
        padding: 24px 20px;
      }
      
      h1 {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="/assets/marinestream_logo_white.png" alt="MarineStream" class="logo">
      <h1>Fleet Command Setup</h1>
      <p class="subtitle">One-time setup to connect to your fleet data</p>
    </div>
    
    <div class="card">
      <h2><span class="step-number">1</span> Add the Magic Button</h2>
      <p>Drag this button to your bookmarks bar. You'll only need to do this once!</p>
      
      <div class="bookmarklet-container">
        <a class="bookmarklet-btn" id="bookmarklet-link" href="#">
          ðŸš€ Get Fleet Token
        </a>
        <p class="drag-hint">
          <strong>â†‘ Drag this button</strong> to your bookmarks bar
        </p>
      </div>
      
      <script>
        // Dashboard URL - use production URL for bookmarklet
        const DASHBOARD_BASE_URL = 'https://marinestream-workspace.onrender.com';
        
        // Generate bookmarklet URL safely
        const bookmarkletCode = `javascript:(function(){
          var s=localStorage,o=sessionStorage,t,k,v,i,found=false;
          function tryParse(str){try{var j=JSON.parse(str);if(j.access_token)return j.access_token;if(j.id_token)return j.id_token;}catch(e){}return null;}
          for(i=0;i<s.length;i++){k=s.key(i);v=s.getItem(k);if(k.includes('oidc')||k.includes('token')||k.includes('auth')){t=tryParse(v);if(t&&t.split('.').length===3){found=true;break;}}}
          if(!found){for(i=0;i<o.length;i++){k=o.key(i);v=o.getItem(k);if(k.includes('oidc')||k.includes('token')||k.includes('auth')){t=tryParse(v);if(t&&t.split('.').length===3){found=true;break;}}}}
          if(found&&t){
            var exp=JSON.parse(atob(t.split('.')[1])).exp*1000;
            var mins=Math.round((exp-Date.now())/60000);
            if(mins>0){
              var overlay=document.createElement('div');
              overlay.innerHTML='<div style="position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:999999;display:flex;align-items:center;justify-content:center;font-family:system-ui"><div style="background:#1e293b;border-radius:16px;padding:32px;max-width:400px;text-align:center;color:#f1f5f9;box-shadow:0 25px 50px rgba(0,0,0,0.5)"><div style="font-size:48px;margin-bottom:12px">âœ…</div><h2 style="font-size:20px;margin:0 0 4px">Token Ready!</h2><p style="color:#94a3b8;margin:0 0 20px;font-size:14px">Valid for '+mins+' minutes</p><input id="ms-token-input" type="text" value="'+t+'" readonly style="width:100%;padding:10px;background:#0f172a;border:1px solid #334155;border-radius:6px;color:#94a3b8;font-size:11px;margin-bottom:12px;font-family:monospace"><button onclick="navigator.clipboard.writeText(document.getElementById(\\'ms-token-input\\').value);this.textContent=\\'Copied!\\'" style="width:100%;padding:12px;background:#3b82f6;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-bottom:8px">Copy Token</button><button onclick="window.open(\\'${DASHBOARD_BASE_URL}/dashboard.html?token='+encodeURIComponent(t)+'\\',\\'_blank\\')" style="width:100%;padding:12px;background:#22c55e;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-bottom:12px">Open Fleet Command â†’</button><button onclick="this.closest(\\'div\\').parentElement.remove()" style="background:none;border:none;color:#64748b;cursor:pointer">Close</button></div></div>';
              document.body.appendChild(overlay);
            }else{alert('Token expired ('+mins+'m). Refresh MarineStream and try again.');}
          }else{alert('No token found. Make sure you\\'re logged into MarineStream.');}
        })();`.replace(/\s+/g, ' ').trim();
        
        document.getElementById('bookmarklet-link').href = bookmarkletCode;
      </script>
      
      <div class="success-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        <span>Don't see your bookmarks bar? Press <span class="highlight">Ctrl+Shift+B</span> (Windows) or <span class="highlight">Cmd+Shift+B</span> (Mac)</span>
      </div>
    </div>
    
    <div class="card">
      <h2><span class="step-number">2</span> How to Use</h2>
      <ol class="steps-list">
        <li>Go to <a href="https://app.marinestream.io" target="_blank" style="color: #3b82f6">app.marinestream.io</a> and log in</li>
        <li>Click the <span class="highlight">ðŸš€ Get Fleet Token</span> bookmark</li>
        <li>A popup will appear - click <span class="highlight">Open Fleet Command</span></li>
        <li>You're in! The dashboard will load with your data</li>
      </ol>
      
      <p style="margin-top: 16px; font-size: 13px; color: #64748b;">
        ðŸ’¡ <strong>Tip:</strong> Tokens last about 60 minutes. If data stops loading, just go back to MarineStream and click the bookmark again.
      </p>
    </div>
    
    <div class="card">
      <h2><span class="step-number">3</span> Ready to Go!</h2>
      <p>Once you've added the bookmark, you're all set. Click below to start using Fleet Command:</p>
      
      <div style="text-align: center; margin-top: 20px;">
        <a href="/dashboard.html" class="btn-primary">
          Open Fleet Command Dashboard
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
    </div>
    
    <div class="footer">
      <p>Need help? Contact <a href="mailto:support@marinestream.com.au">support@marinestream.com.au</a></p>
    </div>
  </div>
</body>
</html>
